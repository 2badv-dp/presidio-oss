parameters:
- name: REGISTRY_NAME
  type: string
  default: ''
- name: TAG
  type: string
  default: ''
- name: BUILD_CONTAINERS
  type: boolean
  default: true
- name: AZURE_SUBSCRIPTION
  type: string
steps:
  - task: DockerCompose@0
    displayName: Build Presidio Images
    condition: eq(${{ parameters.BUILD_CONTAINERS }}, true)
    inputs:
        action: Build services
        dockerComposeFile: docker-compose.yml
        dockerComposeFileArgs: |
          REGISTRY_NAME=${{ parameters.REGISTRY_NAME }}
          TAG=${{ parameters.TAG }}
  - task: DockerCompose@0
    displayName: Push Presidio Images to ACR
    condition: eq(${{ parameters.BUILD_CONTAINERS }}, true)
    inputs:
        action: Push services
        dockerComposeFile: docker-compose.yml  
        containerregistrytype: Azure Container Registry
        azureSubscriptionEndpoint: ${{ parameters.AZURE_SUBSCRIPTION }}
        azureContainerRegistry: ${{ parameters.REGISTRY_NAME }}